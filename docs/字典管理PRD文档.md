# 字典管理 PRD 文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 字典管理模块产品需求文档 |
| 产品名称 | M-WMS 多租户仓库管理系统 |
| 文档版本 | v1.0.0 |
| 创建日期 | 2024-01-27 |
| 产品类型 | SaaS 多租户 B2B WMS 系统 |

---

## 1. 产品概述

### 1.1 功能定位

字典管理模块是系统的核心基础模块，负责管理各类数据字典，为系统提供标准化的下拉选项数据。支持多租户架构，实现租户级和平台级的数据隔离。

### 1.2 目标用户

| 用户类型 | 描述 |
|----------|------|
| 平台管理员 | 管理全局字典，为所有租户提供基础选项 |
| 租户管理员 | 管理租户内字典，可自定义业务选项 |

### 1.3 核心价值

1. **标准化数据**：统一管理系统中的下拉选项，保证数据一致性
2. **灵活配置**：支持动态增删改查，无需修改代码
3. **多租户隔离**：支持租户自定义字典，互不干扰
4. **前端友好**：直接返回 Select 组件所需格式

---

## 2. 业务场景

### 2.1 使用场景

| 场景 | 说明 |
|------|------|
| 行业分类 | 工厂入驻时选择所属行业 |
| 计量单位 | 产品/物料管理中的单位选择 |
| 材质类型 | 产品属性中的材质选项 |
| 状态类型 | 订单状态、库存状态等 |

### 2.2 典型流程

```
┌─────────────────────────────────────────────────────────────┐
│                        用户操作流程                          │
└─────────────────────────────────────────────────────────────┘
     │
     ▼
┌──────────────────┐
│  打开表单页面     │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  调用字典接口     │  GET /api/dicts/options?type=INDUSTRY
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  渲染下拉选项     │  Select组件直接使用返回的label/value
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  用户选择并提交   │
└──────────────────┘
```

---

## 3. 功能需求

### 3.1 获取字典选项

#### 3.1.1 用户故事

> 作为前端开发者，我希望调用一个统一的接口获取下拉选项，以便快速渲染 Select 组件。

#### 3.1.2 功能描述

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 按类型查询 | 根据字典类型获取选项列表 | P0 |
| 自动过滤 | 自动过滤禁用项(isActive=1) | P0 |
| 排序支持 | 按sort字段升序排序 | P1 |
| 租户隔离 | 租户用户只能获取租户内字典 | P0 |
| 禁用缓存 | 添加Cache-Control头防止缓存 | P1 |

#### 3.1.3 返回格式

```javascript
[
  { label: "金属制品业", value: "C33", id: "..." },
  { label: "电气机械制造", value: "C38", id: "..." }
]
```

---

### 3.2 保存字典项

#### 3.2.1 用户故事

> 作为系统管理员，我希望能够添加新的字典项，以便扩展系统选项。

#### 3.2.2 功能描述

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 创建字典 | 支持创建新的字典项 | P0 |
| 租户关联 | 自动关联当前用户租户ID | P0 |
| 默认值 | sort默认0，isActive默认1 | P1 |

#### 3.2.3 业务规则

1. 同一租户内，`(type, value)` 组合建议唯一
2. 平台管理员创建的字典项 `tenantId = null`
3. 租户用户创建的字典项自动关联租户ID

---

### 3.3 更新字典项

#### 3.3.1 用户故事

> 作为系统管理员，我希望能够修改字典项信息，以便纠正错误或更新内容。

#### 3.3.2 功能描述

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 信息更新 | 支持更新所有字段 | P0 |
| 权限验证 | 验证记录存在且属于当前租户 | P0 |
| 返回最新 | 返回更新后的完整数据 | P1 |

#### 3.3.3 业务规则

1. 只能更新属于当前租户的字典项
2. 更新后返回最新数据供前端刷新

---

### 3.4 删除字典项

#### 3.4.1 用户故事

> 作为系统管理员，我希望能够删除不再使用的字典项，以便保持数据清洁。

#### 3.4.2 功能描述

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 删除字典 | 支持删除字典项 | P0 |
| 租户隔离 | 只能删除租户内字典 | P0 |

#### 3.4.3 业务规则

1. 物理删除（非软删除）
2. 只能删除属于当前租户的字典项

---

## 4. 数据模型

### 4.1 Dictionary 实体

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | UUID | 自动 | 主键 |
| tenantId | UUID | 自动 | 租户ID（平台管理员为null） |
| type | string | 是 | 字典类型（如 INDUSTRY, UNIT） |
| label | string | 是 | 展示名称（前端label） |
| value | string | 是 | 实际存值（前端value） |
| sort | number | 是 | 排序（默认0） |
| isActive | tinyint | 是 | 状态（1启用/0禁用），默认1 |
| createdAt | datetime | 是 | 创建时间 |
| updatedAt | datetime | 是 | 更新时间 |
| deletedAt | datetime | 否 | 删除时间（软删除） |

### 4.2 数据隔离机制

```
┌─────────────────────────────────────────────────────────────┐
│                        数据隔离策略                          │
└─────────────────────────────────────────────────────────────┘

平台管理员 (tenantId = null)
├── 全局行业字典 (type=INDUSTRY, tenantId=null)
├── 全局单位字典 (type=UNIT, tenantId=null)
└── 所有租户共享

租户A (tenantId = 'xxx')
├── 租户行业字典 (type=INDUSTRY, tenantId='xxx')
├── 租户单位字典 (type=UNIT, tenantId='xxx')
└── 仅租户A可见

租户B (tenantId = 'yyy')
├── 租户行业字典 (type=INDUSTRY, tenantId='yyy')
├── 租户单位字典 (type=UNIT, tenantId='yyy')
└── 仅租户B可见
```

---

## 5. 预置字典数据

### 5.1 行业分类 (INDUSTRY)

| label | value | sort |
|-------|-------|------|
| 金属制品业 (不锈钢、引出棒、紧固件) | C33 | 1 |
| 电气机械和器材制造 (电热元件、电加热管) | C38 | 2 |
| 通用设备制造业 (数控机床、机械零部件) | C34 | 3 |
| 专用设备制造业 (纺织机械、印刷机械) | C35 | 4 |
| 汽车制造业 (汽车零部件) | C36 | 5 |
| 铁路、船舶、航空航天和其他运输设备制造业 | C37 | 6 |
| 计算机、通信和其他电子设备制造业 | C39 | 7 |
| 仪器仪表制造业 | C40 | 8 |

### 5.2 其他字典类型

| 类型代码 | 类型名称 | 说明 |
|----------|----------|------|
| UNIT | 计量单位 | 个、件、箱、套、kg、g、吨、米等 |
| MATERIAL | 材质类型 | 不锈钢、碳钢、铝合金等 |

---

## 6. 接口清单

| 接口 | 方法 | 路径 | 认证 |
|------|------|------|------|
| 获取字典选项 | GET | /dicts/options | 否 |
| 保存字典项 | POST | /dicts/save | 是 |
| 更新字典项 | POST | /dicts/update | 是 |
| 删除字典项 | POST | /dicts/delete | 是 |

详见《字典管理API接口文档.md》

---

## 7. 非功能需求

### 7.1 性能要求

| 指标 | 要求 |
|------|------|
| 查询响应 | < 200ms |
| 并发支持 | 支持1000+ QPS |

### 7.2 安全要求

| 项目 | 要求 |
|------|------|
| 数据隔离 | 租户间数据完全隔离 |
| 权限验证 | 更新/删除前验证租户归属 |

### 7.3 缓存策略

- 获取选项接口添加 `Cache-Control: no-store` 防止缓存
- 保证前端始终获取最新数据

---

## 8. 版本规划

### v1.0.0 (当前版本)

- 基础字典 CRUD 功能
- 租户数据隔离
- 前端 Select 组件适配

### v1.1.0 (规划中)

- 字典导入/导出
- 字典项批量操作
- 字典分组管理

### v1.2.0 (规划中)

- 多语言支持
- 字典变更历史
- 字典使用统计

---

## 9. 附录

### 9.1 名词解释

| 术语 | 解释 |
|------|------|
| 数据字典 | 系统中用于下拉选择的标准化数据集合 |
| 字典类型 | 字典的分类标识（如 INDUSTRY） |
| label | 前端展示的选项名称 |
| value | 前端提交的选项值 |
| sort | 排序字段，数值越小越靠前 |

### 9.2 前端集成示例

```javascript
// 1. 获取字典选项
const fetchDictOptions = async (type) => {
  const res = await fetch(`/api/dicts/options?type=${type}`);
  const json = await res.json();
  return json.data;
};

// 2. React Select 组件使用
const IndustrySelect = ({ value, onChange }) => {
  const [options, setOptions] = useState([]);

  useEffect(() => {
    fetchDictOptions('INDUSTRY').then(setOptions);
  }, []);

  return (
    <Select
      options={options}
      value={options.find(o => o.value === value)}
      onChange={(option) => onChange(option?.value)}
      placeholder="请选择行业"
    />
  );
};

// 3. Ant Design Select 组件使用
const { Option } = Select;

const IndustrySelect = ({ value, onChange }) => {
  const [options, setOptions] = useState([]);

  useEffect(() => {
    fetchDictOptions('INDUSTRY').then(setOptions);
  }, []);

  return (
    <Select value={value} onChange={onChange} placeholder="请选择行业">
      {options.map(item => (
        <Option key={item.value} value={item.value}>
          {item.label}
        </Option>
      ))}
    </Select>
  );
};
```

### 9.3 相关文档

- [字典管理API接口文档.md](./字典管理API接口文档.md)
- [租户管理API接口文档.md](./租户管理API接口文档.md)
